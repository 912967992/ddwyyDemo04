<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>钉钉H5微应用</title>
    <!-- 引入字体图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- 引入外部CSS文件 -->
    <link rel="stylesheet" href="/css/questPanelStyle.css">

</head>
<body>
<!-- 标题 -->
<div class="title" >任务领取板</div>

<!-- 搜索框 -->
<div class="search-container">
    <div class="search-wrapper">
        <input type="text" class="search-input" placeholder="输入型号或名称搜索">
        <button class="search-btn"><i class="fas fa-search"></i></button>
    </div>
</div>


<!-- 筛选 -->
<div class="filter-container">
    <div class="filter-label">筛选：</div>
    <div class="select-wrapper">
        <select class="filter-select" id="category-filter">
            <option value="all">类别</option>
            <option value="扩展坞">扩展坞</option>
            <option value="投屏器">投屏器</option>
            <option value="切换器">切换器</option>
        </select>
    </div>
    <div class="select-wrapper">
        <select class="filter-select" id="stage-filter">
            <option value="all">阶段</option>
            <option value="大货">大货</option>
            <option value="功能">功能</option>
            <option value="竞品">竞品</option>
        </select>
    </div>
</div>



<!-- 表格列表 -->
<div class="table-container">
    <table class="static-header">
        <thead>
        <tr>
            <th rowspan="2">序号：{{序号}}</th>
            <th>产品型号：{{产品型号}}</th>
            <th>阶段：{{阶段}}</th>
            <th>进度：{{进度}}</th>
        </tr>
        <tr>
            <th colspan="4">产品名称：{{产品名称}}</th>
        </tr>
        </thead>
    </table>
</div>


<!-- 下方固定按钮 -->
<div class="btn-container">
    <hr class="divider"> <!-- 按钮上方的横线 -->
    <!-- 主页按钮 -->
    <button class="btn" id="homeBtn"><i class="fas fa-home"></i></button>
    <!-- 搜索资源库按钮 -->
    <button class="btn" id="cloudBtn"><i class="fas fa-cloud"></i></button>
    <!-- 个人界面按钮 -->
    <button class="btn" id="profileBtn"><i class="fas fa-user"></i></button>
</div>

<!-- 引入 jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        // 页面加载完成后加载数据
        loadData();

        // 监听搜索按钮点击事件
        $('.search-btn').click(function() {
            performSearch();
        });

        // 监听类别选择框变化事件
        $('#category-filter').change(function() {
            performSearch(); // 执行搜索操作
        });

        // 监听阶段选择框变化事件
        $('#stage-filter').change(function() {
            performSearch(); // 执行搜索操作
        });


        function showModal(info) {
            // You can customize the modal dialog implementation
            alert(info); // For demonstration, this will show an alert with the detailed information
        }

        // 加载数据的函数
        function loadData() {
            $.ajax({
                url: '/getQuestPanel', // 后端接口地址
                type: 'GET',
                success: function(data) {
                    console.log('Received data:', data); // 在控制台输出接收到的数据

                    // 检查数据是否为空
                    if (data.length > 0) {
                        // 移除静态表头
                        $('.static-header').remove();

                        // 渲染每个表格
                        data.forEach(function(product, index) {
                            var table = '<table class="bordered">'; // 添加一个类名 "bordered"
                            table += '<thead>';
                            table += '<tr>';
                            table += '<th rowspan="2">' + (index + 1) + '</th>';
                            // 每个单元格的具体值作为title属性的值
                            table += '<th title="产品型号：' + product.product_model + '">' + product.product_model + '</th>';
                            table += '<th title="阶段：' + product.sample_type + '">' + product.sample_type + '</th>';
                            table += '<th title="送样时间：' + product.formattedSendDate + ', 需求完成时间：' + product.formattedDueDate + '">' + '送样时间:' + product.formattedSendDate + '<br>' + '需求完成时间:' + product.formattedDueDate + '</th>';
                            table += '</tr>';
                            table += '<tr>';
                            table += '<th colspan="4" title="产品名称：' + product.product_name + '">' + product.product_name + '</th>';
                            table += '</tr>';
                            table += '</thead>';
                            table += '</table>';

                            // 将表格添加到页面中
                            $('.table-container').append(table);
                        });

                    } else {
                        // 如果没有数据，显示静态表头
                        $('.static-header').show();
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Failed to retrieve data:', status, error);
                }
            });
        }

        // 执行搜索的函数
        function performSearch() {
            // 获取搜索关键词
            var keyword = $('.search-input').val().trim();

            // 获取选定的筛选条件
            var categoryFilter = $('#category-filter').val();
            var stageFilter = $('#stage-filter').val();


            // 发送搜索请求到后端
            $.ajax({
                url: '/searchQuest', // 后端搜索接口地址
                type: 'POST',
                contentType: 'application/json', // 添加这一行
                data: JSON.stringify({
                    keyword: keyword,
                    categoryFilter: categoryFilter,
                    stageFilter: stageFilter
                }),

                success: function(data) {
                    console.log(data);
                    // 清空当前显示的数据
                    $('.table-container').empty();

                    // 渲染新的搜索结果
                    if (data.length > 0) {
                        // 渲染每个表格
                        data.forEach(function(product, index) {
                            var table = '<table class="bordered">'; // 添加一个类名 "bordered"
                            table += '<thead>';
                            table += '<tr>';
                            table += '<th rowspan="2">' + (index + 1) + '</th>';
                            // 每个单元格的具体值作为title属性的值
                            table += '<th title="产品型号：' + product.product_model + '">' + product.product_model + '</th>';
                            table += '<th title="阶段：' + product.sample_type + '">' + product.sample_type + '</th>';
                            table += '<th title="送样时间：' + product.formattedSendDate + ', 需求完成时间：' + product.formattedDueDate + '">' + '送样时间:' + product.formattedSendDate + '<br>' + '需求完成时间:' + product.formattedDueDate + '</th>';
                            table += '</tr>';
                            table += '<tr>';
                            table += '<th colspan="4" title="产品名称：' + product.product_name + '">' + product.product_name + '</th>';
                            table += '</tr>';
                            table += '</thead>';
                            table += '</table>';

                            // 将表格添加到页面中
                            $('.table-container').append(table);
                        });


                    } else {
                        // 如果没有搜索结果，显示提示信息或者其他操作
                        $('.table-container').html('<p>没有搜索对应的数据</p>');
                    }
                },
                error: function(xhr, status, error) {
                    // 打印发送给后端的数据
                    console.log('Data sent to server:', JSON.stringify({
                        keyword: keyword,
                        categoryFilter: categoryFilter,
                        stageFilter: stageFilter
                    }));
                    console.log('Type of data:', typeof data);
                    console.error('Failed to perform search:', status, error);
                }
            });
        }



        // 下方三个按钮跳转页面
        const homeBtn = document.getElementById('homeBtn');
        const cloudBtn = document.getElementById('cloudBtn');
        const profileBtn = document.getElementById('profileBtn');

        // 添加点击事件监听器
        $(homeBtn).click(function() {
            // 跳转到主页
            window.location.href = '/home';
        });

        $(cloudBtn).click(function() {
            // 跳转到搜索资源库页面
            window.location.href = '/cloud';
        });

        $(profileBtn).click(function() {
            // 跳转到个人界面页面
            window.location.href = '/DQEprofile';
        });
    });

    // 检测是否为移动设备
    function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    $(document).ready(function() {
        // 如果是移动设备，将点击事件绑定到每个需要提示的元素上
        if (isMobileDevice()) {
            $('.table-container').on('click', 'table th, table td', function() {
                // 显示提示
                var tooltipText = $(this).attr('title');
                if (tooltipText) {
                    alert(tooltipText); // 这里可以替换成你想要的提示方式，比如使用自定义的提示框
                }
            });
        }
    });

</script>
</body>
</html>
